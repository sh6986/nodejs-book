# REPL

자바스크립트는 스크립트 언어라서 즉석에서 코드를 실행할 수 있음

- REPL 이라는 콘솔 제공
- R(Read), E(Evaluate), P(Print), L(Loop)
- 윈도에서는 명령프롬프트, 맥이나 리눅스에서는 터미널에 node 입력

# 모듈

노드는 자바스크립트 코드를 모듈로 만들 수 있음

- 모듈 : 특정한 기능을 하는 함수나 변수들의 집합
- 모듈로 만들면 여러 프로그램에서 재사용 가능

![Untitled](./uploads/8.png)

- 파일끝에 module.exports로 모듈로 만들 값을 지정
- 다른 파일에서 require(파일 경로)로 그 모듈의 내용 가져올 수 있음
- require로 받아올 때 구조분해 가능

    ```java
    const { odd, even } = require('./var');
    ```

- 이거는 노드의 모듈시스템이고 자바스크립트의 모듈시스템은 따로 있다.

  module.exports → export default

  const { odd, even } = require('./var'); → import { odd, even } from './var';

    - 그렇다고 module.exports 와 export defalut 가 같고, const {} = require(); 와 import {} from '' 이 같은 건 아니므로 바꿔도 안바꿔지는 경우도 있다.

# 노드 내장 객체

## global

노드의 전역 객체

- 브라우저의 window같은 역할
- 모든 파일에서 접근 가능
- window처럼 생략도 가능(console, require도 global의 속성)

## console 객체

브라우저의 console 객체와 매우 유사

- console.time, console.timeEnd: 시간 로깅
- console.error: 에러 로깅
- console.log: 평범한 로그
- console.dir: 객체 로깅
- console.trace: 호출스택 로깅

## 타이머 메서드

set 메서드에 clear 메서드가 대응됨

- set 메서드의 리턴 값(아이디)을 clear 메서드에 넣어 취소
- setTimeout(콜백함수, 밀리초) : 주어진 밀리초(1000분의 1초) 이후에 콜백함수를 실행합니다.
- setInterval(콜백함수, 밀리초) : 주어진 밀리초마다 콜백 함수 반복 실행
- setImmediate(콜백 함수) : 콜백 함수를 즉시 실행
- clearTimeout(아이디) : setTimeout을 취소
- clearInterval(아이디) : setInteral을 취소
- clearImmediate(아이디) : setImmediate를 취소

## __filename, __dirname

- __filename : 현재 파일 경로
- __dirname : 현재 폴더(디렉토리) 경로

## module, exports

module.exports 외에도 exports로 모듈을 만들 수 있음

```java
exports.odd = '홀수입니다';
exports.even = '짝수입니다.';
```

- 동일한 이유는 module.exports와 exports가 참조관계이기 때문
- exports에 객체의 속성이 아닌 다른 값을 대입하면 참조관계가 깨짐
- exports = module.exports = {}

## this

노드에서 this를 사용할 때 주의점이 있음

- 최상위 스코프의 this는 module.exports를 가리킴
- 그 외에는 브라우저의 자바스크립트와 동일
- 함수 선언문 내부의 this는 global(전역) 객체를 가리킴

## require의 특성

- require가 제일 위에 올 필요는 없음 (import 같은 경우는 제일 위에 와야함)
- require.cache에 한번 require한 모듈에 대한 캐슁 정보가 들어있음
- require.main은 노드 실행 시 첫 모듈을 가리킴

## 순환 참조

두 개의 모듈이 서로를 require하는 상황을 조심해야 함

- Dep1이 dep2를 require 하고, dep2가 dep1을 require 함
- Dep1의 module.exports가 함수가 아니라 빈 객체가 됨 (무한 반복을 막기 위해 의도됨)
- 순환참조하는 상황이 나오지 않도록 하는 게 좋음

## process

현재 실행중인 노드 프로세스에 대한 정보를 담고 있음

- 컴퓨터마다 출력값이 PPT와 다를 수 있음

![Untitled](./uploads/9.png)

## process.env

시스템 환경 변수들이 들어있는 객체

- 비밀키(데이터베이스 비밀번호, 서드파티 앱 키 등)를 보관하는 용도로도 쓰임
- 환경 변수는 process.env로 접근 가능

    ```java
    const secretId = process.env.SECRET_ID;
    const secretCode = process.env.SECRET_CODE;
    ```

- 일부 환경 변수는 노드 실행 시 영향을 미침
- 예시) NODE_OPTIONS(노드실행옵션), UV_THREADROOL_SIZE(스레드풀 개수)
    - max-old-space-size는 노드가 사용할 수 있는 메모리를 지정하는 옵션

## process.nexttTick(콜백)

이벤트 루프가 다른 콜백 함수들보다 nextTick의 콜백 함수를 우선적으로 처리함

- 너무 남용하면 다른 콜백 함수들 실행이 늦어짐
- 비슷한 경우로 promise가 있음(nextTick처럼 우선순위가 높음)
- 아래 예제에서 setImmediate, setTimeout 보다 promise와 nextTick이 먼저 실행됨

```java
setImmediate(() => {
	console.loog('immediate');
});
process.nextTick(() => {
	console.log('nextTick');
});
setTimeout(() => {
	console.log('timeout');
}, 0);
Promise.resolve().then(() => console.log('promise'));

// nextTick
// promise
// timeout
// immediate
```

## process.exit(코드)

현재의 프로세스를 멈춤

- 코드가 없거나 0이면 정상 종료
- 이외의 코드는 비정상종료를 의미함